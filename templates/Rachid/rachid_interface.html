{% extends 'core/Rachid_base.html' %}
{% block title %}{{title}}{% endblock title %}

    
{% block rachid %}
<div class="container mt-5">
    
    {% if title == 'Home' %}

    <div class="container text-center mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow-lg">
                    <div class="card-header bg-primary text-white">
                        <h2>Welcome Home, Mr. Rachid Mojahid!</h2>
                    </div>
                    <div class="card-body">
                        <p class="lead">We're glad to have you back.</p>
                        <p>Feel free to explore the site and let us know if you need anything!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-light text-center py-3 mt-5">
        <p>&copy; 2024 Rachid Mojahid's Website. All Rights Reserved.</p>
    </footer>

    {% endif %}
        
    {% if title == 'Dashboard' %}
    <h1 class="text-center mt-4"> Dashboard</h1>
    <div class="row">
        <!-- Column 1 -->
        <div class="col-md-6">
            <div class="stat-column bg-light">
                <h4>low stock products</h4>
                <p>Information about low stock products.</p>
                <p><strong>Statistic:</strong> {{low_stock_products}}</p>
            </div>
        </div>
        <!-- Column 2 -->
        <div class="col-md-6">
            <div class="stat-column bg-light">
                <h4>newest orders</h4>
                <p>Information about newest orders.</p>
                <p><strong>Statistic:</strong> {{newest_orders}}</p>
            </div>
        </div>
        <!-- Column 3 -->
        <div class="col-md-6">
            <div class="stat-column bg-light">
                <h4>recent contacts made by call</h4>
                <p>Information about contacts made by call.</p>
                <p><strong>Statistic:</strong> {{recent_contacts_made_by_call}}</p>
            </div>
        </div>
        <!-- Column 4 -->
        <div class="col-md-6">
            <div class="stat-column bg-light">
                <h4>recent visitors</h4>
                <p>Information about recent visitors.</p>
                <p><strong>Statistic:</strong> {{recent_visitors}}</p>
            </div>
        </div>
        <!-- Column 5 -->
        <div class="col-md-6">
            <div class="stat-column bg-light">
                <h4>Valid orders</h4>
                <p>Information about valid orders.</p>
                <p><strong>Statistic:</strong> {{valid_orders}}</p>
            </div>
        </div>
        <!-- Column 6 -->

        <div class="col-md-6">
            <div class="stat-column bg-light">
                <h4>cancelled Order</h4>
                <p>Information about cancelled Order.</p>
                <p><strong>Statistic:</strong>{{cancelled_orders}}</p>
            </div>
        </div>
    </div>
    {% endif %}
    {% if title == 'Orders' %}
    <h1 class="text-center mt-4">Order Details</h1>
    <div class="row">
        <div class="col-2">
            

        </div>
        <div class="col-2">
            <a href='{% url "orders:Valid_Orders" %}' class="btn btn-success">validated</a>
        </div>
        <div class="col-2">
            <a href='{% url "orders:Returned_Orders" %}' class="btn btn-dark">returned</a>
        </div>
        <div class="col-2">
            <a href='{% url "orders:Cancelled_Orders" %}' class="btn btn-danger">cancelled</a>
        </div>
        <div class="col-2">
            <a href='{% url "orders:Delivered_Orders" %}' class="btn btn-secondary">delivered</a>
        </div>
        <div class="col-2">
        </div>
    </div>   
    <div class="table-container">
        <table class="table table-bordered table-striped">
            <thead class="thead-dark">
                <tr>
                    <th>ID</th>
                    <th>Phone</th>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Order Date</th>
                    <th>Delivery Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if orders %}                    
                {% for order in orders %}
                <tr>
                    <td>{{ order.id }}</td>
                    <td>{{ order.user.phone }}</td>
                    <td>{{ order.products.first.name }}</td>
                    <td>{{ order.orderitem_set.first.quantity }}</td>
                    <td>{{ order.orderitem_set.first.subtotal }}</td>
                    <td>{{ order.status }}</td>
                    <td>{{ order.created_at }}</td>
                    <td>{{ order.delivered_at }}</td>
                    <td>
                        <div class='btn btn-sm btn-danger toggle-card-btn' id="toggle-card-btn-{{ order.id }}">See action</div>
                    </td>
                </tr>
    
                <tr>
                    <td colspan="9">
                        <div id="card-{{ order.id }}" class="card drop_down" style="display: none;">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-6">
                                        <h5 class="card-title">Make action for Order {{ order.id }}</h5>
                                    </div>
                                    <div class="col-4">
                                        <button class="btn btn-sm warning close-btn" id="close-btn-{{ order.id }}">
                                            <span aria-hidden="true">X</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class='row'>
                                    <div class="col-md-3 mt-4">
                                        <a href="{% url 'orders:validated' order.id %}" class="btn btn-success btn-lg">
                                            <section class="m-3">
                                                Validate Order
                                            </section>
                                        </a>
                                    </div>
                                    <div class="col-md-3 mt-4">
                                        <a href="{% url 'orders:returned' order.id %}" class="btn btn-dark btn-lg">
                                        <section class="m-3">
                                            Return Order
                                        </section>
                                        </a>
                                    </div>
                                    <div class="col-md-3 mt-4">
                                        <a href="{% url 'orders:cancelled' order.id %}" class="btn btn-danger btn-lg">
                                        <section class="m-3">
                                            Cancel Order
                                        </section>
                                        </a>
                                    </div>
                                    <div class="col-md-3 mt-4">
                                        <a href="{% url 'orders:delivered' order.id %}" class="btn btn-secondary btn-lg">
                                                <section class="m-3">
                                                    Deliver Order
                                                </section>
                                        </a>
                                    </div>
                                    <div class="col-md-3 mt-4">
                                            <a href="{% url 'orders:order_edit' order.id %}" class="btn btn-info btn-lg">
                                                <section class="m-3">
                                                    Edit Order
                                                </section>
                                            </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="9">
                    <div class="row justify-content-center mt-5">
                        <div class="col-lg-8 text-center">
                            <div class="alert alert-warning" role="alert">
                                <h4 class="alert-heading">No Orders Found</h4>
                                <p>It looks like you haven't placed any orders yet, or we couldn't find your orders in our system.</p>
                                <hr>
                                <p class="mb-0">If you believe this is an error, please check back later or contact support.</p>
                            </div>
                            <a href="{% url 'Rachid:rhome' %}" class="btn btn-primary mt-3">Back to Home</a>
                            <a href="{% url 'Rachid:dashboard' %}" class="btn btn-outline-secondary mt-3">Check Orders Again</a>
                        </div>
                    </div>
                    </td>
                </tr>
                {% endif %}
            </tbody>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // Select all toggle buttons
                    document.querySelectorAll('.toggle-card-btn').forEach(function(toggleBtn) {
                        const orderId = toggleBtn.id.split('-')[3];  // Extract the order ID from the button's ID
                
                        // Get the corresponding card and close button
                        const card = document.getElementById(`card-${orderId}`);
                        const closeBtn = document.getElementById(`close-btn-${orderId}`);
                
                        // Toggle the card visibility when the toggle button is clicked
                        toggleBtn.addEventListener('click', function() {
                            card.style.display = 'block';
                        });
                
                        // Hide the card when the close button is clicked
                        closeBtn.addEventListener('click', function() {
                            card.style.display = 'none';
                        });
                    });
                });                
            </script>
        </table>
    </div>
    
    {% endif %}
    {% if title == 'Products' %}
    <p> Product</p>    
    {% endif %}
    {% if title == 'Visitors' %}
    <h1 class="text-center mt-4"> Visitors</h1>
    <div class="row">
        <!-- Column 1 -->
        <div class="col-md-6">
            <div class="stat-column bg-light">
                <h4>total visitors</h4>
                <p>Information about total_visitors.</p>
                <p><strong>Statistic:</strong> {{total_visitors}}</p>
            </div>
        </div>
        <div class="col-md-6">
            <div class="stat-column bg-light">
                <h4>orderd</h4>
                <p>Information about total visitors who : orderd</p>
                <p><strong>Statistic:</strong> {{total_orderd_visitors}}</p>
            </div>
        </div>
        <div class="col-md-6">
            <div class="stat-column bg-light">
                <h4>not ordered</h4>
                <p>Information about total visitors who:  not ordered.</p>
                <p><strong>Statistic:</strong> {{total_visitors_not_ordered}}</p>
            </div>
        </div>
        <div class="col-md-6">
            <div class="stat-column bg-light">
                <h4>total visits from distinct browsers</h4>
                <p>Information about total visitors who:  ordered from individual browsers.</p>
                <p><strong>Statistic:</strong> {{total_visitors_with_same_devise}}</p>
            </div>
        </div>
    </div>

    {% endif %}
    {% if title == 'contacts made via calls' %}
    <h1 class="text-center mt-5"> Contacts Made via Calls</h1>
    <div class="row">
        <div class="col-md-5">
            <div class="stat-column bg-light">
                <h4>total calls made</h4>
                <p>Information about toatl calls .</p>
                <p><strong>Statistic:</strong> {{total_calls}} {% if total_calls == 1 %}call{% else %}Calls{% endif %}</p>
            </div>
        </div>
    </div>
    <div class="row">
    <div class="col-md-11 ml-5">
    <div class="table-container ml-5">
        <table class="table table-bordered table-striped">
            <thead class="thead-dark">
                <tr>
                    <th>Order ID</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Order Date</th>
                    <th>Delivery Date</th>
                    <th>taken Action</th>

                </tr>
            </thead>
            <tbody>
                <!-- Repeat this TR block for each order -->
                
                {% if orders %}                    
                {% for order in orders %} 
                
                <tr>
                    <td>{{order.id}}</td>
                    <td>{{order.user.phone}}</td>
                    <td>{{order.status}}</td>
                    <td>{{order.created_at}}</td>
                    <td>{{order.delivered_at}}</td>
                    <td>{{order.status}}</td>
                </tr>                                   
                {% endfor %}
                {% else %}
                <tr>
                <td colspan="6">
                <div class="row justify-content-center mt-5">
                    <div class="col-lg-8 text-center">
                        <div class="alert alert-warning" role="alert">
                            <h4 class="alert-heading">No Calls Have been made</h4>
                            <p>It looks like you haven't placed any orders yet, or we couldn't find your orders in our system.</p>
                            <hr>
                            <p class="mb-0">If you believe this is an error, please check back later or contact support.</p>
                        </div>
                        <a href="{% url 'Rachid:rhome' %}" class="btn btn-primary mt-3">Back to Home</a>
                        <a href="{% url 'Rachid:dashboard' %}" class="btn btn-outline-secondary mt-3">Check Orders Again</a>
                    </div>
                </div>
                </td>
                </tr>
                {% endif %}

            </tbody>
        </table>
    </div>
    </div>
</div>

 
    {% endif %}
   
{% endblock%}
